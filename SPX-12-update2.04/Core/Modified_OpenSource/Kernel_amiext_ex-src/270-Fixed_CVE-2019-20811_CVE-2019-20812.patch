diff -Naur linux.old/net/core/net-sysfs.c linux.new/net/core/net-sysfs.c
--- linux.old/net/core/net-sysfs.c	2020-11-30 16:02:17.853884426 +0800
+++ linux.new/net/core/net-sysfs.c	2020-11-30 16:03:37.323765426 +0800
@@ -775,6 +775,8 @@
 	if (error)
 		goto exit;
 
+	dev_hold(queue->dev);
+
 	if (net->sysfs_rx_queue_group) {
 		error = sysfs_create_group(kobj, net->sysfs_rx_queue_group);
 		if (error)
@@ -782,7 +784,6 @@
 	}
 
 	kobject_uevent(kobj, KOBJ_ADD);
-	dev_hold(queue->dev);
 
 	return error;
 exit:
@@ -1137,6 +1138,8 @@
 	if (error)
 		goto exit;
 
+	dev_hold(queue->dev);
+
 #ifdef CONFIG_BQL
 	error = sysfs_create_group(kobj, &dql_group);
 	if (error)
@@ -1144,7 +1147,6 @@
 #endif
 
 	kobject_uevent(kobj, KOBJ_ADD);
-	dev_hold(queue->dev);
 
 	return 0;
 exit:
diff -Naur linux.old/net/packet/af_packet.c linux.new/net/packet/af_packet.c
--- linux.old/net/packet/af_packet.c	2020-11-30 16:04:08.020491813 +0800
+++ linux.new/net/packet/af_packet.c	2020-11-30 16:04:45.969389690 +0800
@@ -587,7 +587,8 @@
 			msec = 1;
 			div = speed / 1000;
 		}
-	}
+	} else
+		return DEFAULT_PRB_RETIRE_TOV;
 
 	mbits = (blk_size_in_bytes * 8) / (1024 * 1024);
 
