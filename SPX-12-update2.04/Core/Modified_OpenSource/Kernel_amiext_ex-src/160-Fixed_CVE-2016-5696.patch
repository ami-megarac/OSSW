diff -Naur linux_org/net/ipv4/tcp_input.c linux/net/ipv4/tcp_input.c
--- linux_org/net/ipv4/tcp_input.c	2019-03-27 14:09:52.407898917 +0800
+++ linux/net/ipv4/tcp_input.c	2019-03-27 14:28:11.395137202 +0800
@@ -3318,17 +3318,19 @@
 	/* unprotected vars, we dont care of overwrites */
 	static u32 challenge_timestamp;
 	static unsigned int challenge_count;
-	u32 now = jiffies / HZ;
-	u32 count=0;
+	u32 count, now = jiffies / HZ;	
 
 	if (now != challenge_timestamp) {
 		u32 half = (sysctl_tcp_challenge_ack_limit + 1) >> 1;
 		challenge_timestamp = now;
-		WRITE_ONCE(challenge_count, half + prandom_u32_max(sysctl_tcp_challenge_ack_limit));
+		ACCESS_ONCE(challenge_count) =
+			half + (u32)(
+			((u64) prandom_u32() * sysctl_tcp_challenge_ack_limit)
+			>> 32);
 	}
-	count = READ_ONCE(challenge_count);
+	count = ACCESS_ONCE(challenge_count);
 	if (count > 0) {
-		WRITE_ONCE(challenge_count, count - 1);
+		ACCESS_ONCE(challenge_count) = count - 1;
 		NET_INC_STATS_BH(sock_net(sk), LINUX_MIB_TCPCHALLENGEACK);
 		tcp_send_ack(sk);
 	}
