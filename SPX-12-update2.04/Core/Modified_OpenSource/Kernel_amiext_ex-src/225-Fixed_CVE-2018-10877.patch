--- a/fs/ext4/ext4_extents.h	2019-08-06 16:31:46.158723309 +0800
+++ b/fs/ext4/ext4_extents.h	2019-08-07 15:36:02.783880176 +0800
@@ -103,6 +103,7 @@
 };
 
 #define EXT4_EXT_MAGIC		cpu_to_le16(0xf30a)
+#define EXT4_MAX_EXTENT_DEPTH	5
 
 #define EXT4_EXTENT_TAIL_OFFSET(hdr) \
 	(sizeof(struct ext4_extent_header) + \
--- a/fs/ext4/extents.c	2019-08-06 16:31:48.098723770 +0800
+++ b/fs/ext4/extents.c	2019-08-07 15:37:33.295868305 +0800
@@ -849,6 +849,12 @@
 
 	eh = ext_inode_hdr(inode);
 	depth = ext_depth(inode);
+	if (depth < 0 || depth > EXT4_MAX_EXTENT_DEPTH) {
+		EXT4_ERROR_INODE(inode, "inode has invalid extent depth: %d",
+				 depth);
+		ret = -EIO;
+		goto err;
+	}
 
 	/* account possible depth increase */
 	if (!path) {
