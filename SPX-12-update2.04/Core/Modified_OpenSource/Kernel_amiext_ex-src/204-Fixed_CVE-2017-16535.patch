diff -Naur linux_org/drivers/usb/core/config.c linux/drivers/usb/core/config.c
--- linux_org/drivers/usb/core/config.c	2019-04-11 14:45:34.207151074 +0800
+++ linux/drivers/usb/core/config.c	2019-04-11 14:57:20.183660439 +0800
@@ -821,10 +821,11 @@
 	for (i = 0; i < num; i++) {
 		buffer += length;
 		cap = (struct usb_dev_cap_header *)buffer;
-		length = cap->bLength;
-
-		if (total_len < length)
+		if (total_len < sizeof(*cap) || total_len < cap->bLength) {
+			dev->bos->desc->bNumDeviceCaps = i;
 			break;
+		}
+		length = cap->bLength;			
 		total_len -= length;
 
 		if (cap->bDescriptorType != USB_DT_DEVICE_CAPABILITY) {
